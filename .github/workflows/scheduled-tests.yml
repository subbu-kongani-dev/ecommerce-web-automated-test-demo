name: Scheduled Smoke Tests

on:
  schedule:
    # Run every day at 2 AM UTC
    #- cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  smoke-tests:
    name: Daily Smoke Tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: maven
      
      - name: Install Chrome
        uses: browser-actions/setup-chrome@latest
        with:
          chrome-version: stable
      
      - name: Run Smoke Tests
        run: mvn test -Dbrowser=chrome -Dheadless=true
        continue-on-error: true
      
      - name: Upload Test Reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: scheduled-test-reports-${{ github.run_number }}
          path: |
            reports/
            screenshots/
            logs/
          retention-days: 30
      
      - name: Send Notification on Failure
        if: failure()
        run: |
          echo "⚠️ Scheduled tests failed! Check the artifacts for details."
          echo "Run Number: ${{ github.run_number }}"
          echo "Run URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
